;;; Tests

(in-package #:des-tests)

(sb-rt:deftest test-initial-permutation
    (and
     (= (des::initial-permutation #b1000000000000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 40)))
     (= (des::initial-permutation #b0100000000000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 8)))
     (= (des::initial-permutation #b0010000000000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 48)))
     (= (des::initial-permutation #b0001000000000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 16)))
     (= (des::initial-permutation #b0000100000000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 56)))
     (= (des::initial-permutation #b0000010000000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 24)))
     (= (des::initial-permutation #b0000001000000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 64)))
     (= (des::initial-permutation #b0000000100000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 32)))

     (= (des::initial-permutation #b0000000010000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 39)))
     (= (des::initial-permutation #b0000000001000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 7)))
     (= (des::initial-permutation #b0000000000100000000000000000000000000000000000000000000000000000) (expt 2 (- 64 47)))
     (= (des::initial-permutation #b0000000000010000000000000000000000000000000000000000000000000000) (expt 2 (- 64 15)))
     (= (des::initial-permutation #b0000000000001000000000000000000000000000000000000000000000000000) (expt 2 (- 64 55)))
     (= (des::initial-permutation #b0000000000000100000000000000000000000000000000000000000000000000) (expt 2 (- 64 23)))
     (= (des::initial-permutation #b0000000000000010000000000000000000000000000000000000000000000000) (expt 2 (- 64 63)))
     (= (des::initial-permutation #b0000000000000001000000000000000000000000000000000000000000000000) (expt 2 (- 64 31)))

     (= (des::initial-permutation #b0000000000000000100000000000000000000000000000000000000000000000) (expt 2 (- 64 38)))
     (= (des::initial-permutation #b0000000000000000010000000000000000000000000000000000000000000000) (expt 2 (- 64 6)))
     (= (des::initial-permutation #b0000000000000000001000000000000000000000000000000000000000000000) (expt 2 (- 64 46)))
     (= (des::initial-permutation #b0000000000000000000100000000000000000000000000000000000000000000) (expt 2 (- 64 14)))
     (= (des::initial-permutation #b0000000000000000000010000000000000000000000000000000000000000000) (expt 2 (- 64 54)))
     (= (des::initial-permutation #b0000000000000000000001000000000000000000000000000000000000000000) (expt 2 (- 64 22)))
     (= (des::initial-permutation #b0000000000000000000000100000000000000000000000000000000000000000) (expt 2 (- 64 62)))
     (= (des::initial-permutation #b0000000000000000000000010000000000000000000000000000000000000000) (expt 2 (- 64 30)))

     (= (des::initial-permutation #b0000000000000000000000001000000000000000000000000000000000000000) (expt 2 (- 64 37)))
     (= (des::initial-permutation #b0000000000000000000000000100000000000000000000000000000000000000) (expt 2 (- 64 5)))
     (= (des::initial-permutation #b0000000000000000000000000010000000000000000000000000000000000000) (expt 2 (- 64 45)))
     (= (des::initial-permutation #b0000000000000000000000000001000000000000000000000000000000000000) (expt 2 (- 64 13)))
     (= (des::initial-permutation #b0000000000000000000000000000100000000000000000000000000000000000) (expt 2 (- 64 53)))
     (= (des::initial-permutation #b0000000000000000000000000000010000000000000000000000000000000000) (expt 2 (- 64 21)))
     (= (des::initial-permutation #b0000000000000000000000000000001000000000000000000000000000000000) (expt 2 (- 64 61)))
     (= (des::initial-permutation #b0000000000000000000000000000000100000000000000000000000000000000) (expt 2 (- 64 29)))

     (= (des::initial-permutation #b0000000000000000000000000000000010000000000000000000000000000000) (expt 2 (- 64 36)))
     (= (des::initial-permutation #b0000000000000000000000000000000001000000000000000000000000000000) (expt 2 (- 64 4)))
     (= (des::initial-permutation #b0000000000000000000000000000000000100000000000000000000000000000) (expt 2 (- 64 44)))
     (= (des::initial-permutation #b0000000000000000000000000000000000010000000000000000000000000000) (expt 2 (- 64 12)))
     (= (des::initial-permutation #b0000000000000000000000000000000000001000000000000000000000000000) (expt 2 (- 64 52)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000100000000000000000000000000) (expt 2 (- 64 20)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000010000000000000000000000000) (expt 2 (- 64 60)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000001000000000000000000000000) (expt 2 (- 64 28)))

     (= (des::initial-permutation #b0000000000000000000000000000000000000000100000000000000000000000) (expt 2 (- 64 35)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000010000000000000000000000) (expt 2 (- 64 3)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000001000000000000000000000) (expt 2 (- 64 43)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000100000000000000000000) (expt 2 (- 64 11)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000010000000000000000000) (expt 2 (- 64 51)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000001000000000000000000) (expt 2 (- 64 19)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000100000000000000000) (expt 2 (- 64 59)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000010000000000000000) (expt 2 (- 64 27)))

     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000001000000000000000) (expt 2 (- 64 34)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000000100000000000000) (expt 2 (- 64 2)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000000010000000000000) (expt 2 (- 64 42)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000000001000000000000) (expt 2 (- 64 10)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000000000100000000000) (expt 2 (- 64 50)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000000000010000000000) (expt 2 (- 64 18)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000000000001000000000) (expt 2 (- 64 58)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000000000000100000000) (expt 2 (- 64 26)))

     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000000000000010000000) (expt 2 (- 64 33)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000000000000001000000) (expt 2 (- 64 1)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000000000000000100000) (expt 2 (- 64 41)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000000000000000010000) (expt 2 (- 64 9)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000000000000000001000) (expt 2 (- 64 49)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000000000000000000100) (expt 2 (- 64 17)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000000000000000000010) (expt 2 (- 64 57)))
     (= (des::initial-permutation #b0000000000000000000000000000000000000000000000000000000000000001) (expt 2 (- 64 25))))
  t)

(sb-rt:deftest test-inverse-initial-permutation
    (and
     (= (des::inverse-initial-permutation #b1000000000000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 58)))
     (= (des::inverse-initial-permutation #b0100000000000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 50)))
     (= (des::inverse-initial-permutation #b0010000000000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 42)))
     (= (des::inverse-initial-permutation #b0001000000000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 34)))
     (= (des::inverse-initial-permutation #b0000100000000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 26)))
     (= (des::inverse-initial-permutation #b0000010000000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 18)))
     (= (des::inverse-initial-permutation #b0000001000000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 10)))
     (= (des::inverse-initial-permutation #b0000000100000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 2)))

     (= (des::inverse-initial-permutation #b0000000010000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 60)))
     (= (des::inverse-initial-permutation #b0000000001000000000000000000000000000000000000000000000000000000) (expt 2 (- 64 52)))
     (= (des::inverse-initial-permutation #b0000000000100000000000000000000000000000000000000000000000000000) (expt 2 (- 64 44)))
     (= (des::inverse-initial-permutation #b0000000000010000000000000000000000000000000000000000000000000000) (expt 2 (- 64 36)))
     (= (des::inverse-initial-permutation #b0000000000001000000000000000000000000000000000000000000000000000) (expt 2 (- 64 28)))
     (= (des::inverse-initial-permutation #b0000000000000100000000000000000000000000000000000000000000000000) (expt 2 (- 64 20)))
     (= (des::inverse-initial-permutation #b0000000000000010000000000000000000000000000000000000000000000000) (expt 2 (- 64 12)))
     (= (des::inverse-initial-permutation #b0000000000000001000000000000000000000000000000000000000000000000) (expt 2 (- 64 4)))

     (= (des::inverse-initial-permutation #b0000000000000000100000000000000000000000000000000000000000000000) (expt 2 (- 64 62)))
     (= (des::inverse-initial-permutation #b0000000000000000010000000000000000000000000000000000000000000000) (expt 2 (- 64 54)))
     (= (des::inverse-initial-permutation #b0000000000000000001000000000000000000000000000000000000000000000) (expt 2 (- 64 46)))
     (= (des::inverse-initial-permutation #b0000000000000000000100000000000000000000000000000000000000000000) (expt 2 (- 64 38)))
     (= (des::inverse-initial-permutation #b0000000000000000000010000000000000000000000000000000000000000000) (expt 2 (- 64 30)))
     (= (des::inverse-initial-permutation #b0000000000000000000001000000000000000000000000000000000000000000) (expt 2 (- 64 22)))
     (= (des::inverse-initial-permutation #b0000000000000000000000100000000000000000000000000000000000000000) (expt 2 (- 64 14)))
     (= (des::inverse-initial-permutation #b0000000000000000000000010000000000000000000000000000000000000000) (expt 2 (- 64 6)))

     (= (des::inverse-initial-permutation #b0000000000000000000000001000000000000000000000000000000000000000) (expt 2 (- 64 64)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000100000000000000000000000000000000000000) (expt 2 (- 64 56)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000010000000000000000000000000000000000000) (expt 2 (- 64 48)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000001000000000000000000000000000000000000) (expt 2 (- 64 40)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000100000000000000000000000000000000000) (expt 2 (- 64 32)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000010000000000000000000000000000000000) (expt 2 (- 64 24)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000001000000000000000000000000000000000) (expt 2 (- 64 16)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000100000000000000000000000000000000) (expt 2 (- 64 8)))

     (= (des::inverse-initial-permutation #b0000000000000000000000000000000010000000000000000000000000000000) (expt 2 (- 64 57)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000001000000000000000000000000000000) (expt 2 (- 64 49)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000100000000000000000000000000000) (expt 2 (- 64 41)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000010000000000000000000000000000) (expt 2 (- 64 33)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000001000000000000000000000000000) (expt 2 (- 64 25)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000100000000000000000000000000) (expt 2 (- 64 17)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000010000000000000000000000000) (expt 2 (- 64 9)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000001000000000000000000000000) (expt 2 (- 64 1)))

     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000100000000000000000000000) (expt 2 (- 64 59)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000010000000000000000000000) (expt 2 (- 64 51)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000001000000000000000000000) (expt 2 (- 64 43)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000100000000000000000000) (expt 2 (- 64 35)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000010000000000000000000) (expt 2 (- 64 27)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000001000000000000000000) (expt 2 (- 64 19)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000100000000000000000) (expt 2 (- 64 11)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000010000000000000000) (expt 2 (- 64 3)))

     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000001000000000000000) (expt 2 (- 64 61)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000000100000000000000) (expt 2 (- 64 53)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000000010000000000000) (expt 2 (- 64 45)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000000001000000000000) (expt 2 (- 64 37)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000000000100000000000) (expt 2 (- 64 29)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000000000010000000000) (expt 2 (- 64 21)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000000000001000000000) (expt 2 (- 64 13)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000000000000100000000) (expt 2 (- 64 5)))

     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000000000000010000000) (expt 2 (- 64 63)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000000000000001000000) (expt 2 (- 64 55)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000000000000000100000) (expt 2 (- 64 47)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000000000000000010000) (expt 2 (- 64 39)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000000000000000001000) (expt 2 (- 64 31)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000000000000000000100) (expt 2 (- 64 23)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000000000000000000010) (expt 2 (- 64 15)))
     (= (des::inverse-initial-permutation #b0000000000000000000000000000000000000000000000000000000000000001) (expt 2 (- 64 7))))
  t)

(sb-rt:deftest test-e-permutation
    (and
     (= (des::e #b10000000000000000000000000000000) #b010000000000000000000000000000000000000000000001)
     (= (des::e #b01000000000000000000000000000000) #b001000000000000000000000000000000000000000000000)
     (= (des::e #b00100000000000000000000000000000) #b000100000000000000000000000000000000000000000000)
     (= (des::e #b00010000000000000000000000000000) #b000010100000000000000000000000000000000000000000)
     (= (des::e #b00001000000000000000000000000000) #b000001010000000000000000000000000000000000000000)
     (= (des::e #b00000100000000000000000000000000) #b000000001000000000000000000000000000000000000000)
     (= (des::e #b00000010000000000000000000000000) #b000000000100000000000000000000000000000000000000)
     (= (des::e #b00000001000000000000000000000000) #b000000000010100000000000000000000000000000000000)
     (= (des::e #b00000000100000000000000000000000) #b000000000001010000000000000000000000000000000000)
     (= (des::e #b00000000010000000000000000000000) #b000000000000001000000000000000000000000000000000)
     (= (des::e #b00000000001000000000000000000000) #b000000000000000100000000000000000000000000000000)
     (= (des::e #b00000000000100000000000000000000) #b000000000000000010100000000000000000000000000000)
     (= (des::e #b00000000000010000000000000000000) #b000000000000000001010000000000000000000000000000)
     (= (des::e #b00000000000001000000000000000000) #b000000000000000000001000000000000000000000000000)
     (= (des::e #b00000000000000100000000000000000) #b000000000000000000000100000000000000000000000000)
     (= (des::e #b00000000000000010000000000000000) #b000000000000000000000010100000000000000000000000)
     (= (des::e #b00000000000000001000000000000000) #b000000000000000000000001010000000000000000000000)
     (= (des::e #b00000000000000000100000000000000) #b000000000000000000000000001000000000000000000000)
     (= (des::e #b00000000000000000010000000000000) #b000000000000000000000000000100000000000000000000)
     (= (des::e #b00000000000000000001000000000000) #b000000000000000000000000000010100000000000000000)
     (= (des::e #b00000000000000000000100000000000) #b000000000000000000000000000001010000000000000000)
     (= (des::e #b00000000000000000000010000000000) #b000000000000000000000000000000001000000000000000)
     (= (des::e #b00000000000000000000001000000000) #b000000000000000000000000000000000100000000000000)
     (= (des::e #b00000000000000000000000100000000) #b000000000000000000000000000000000010100000000000)
     (= (des::e #b00000000000000000000000010000000) #b000000000000000000000000000000000001010000000000)
     (= (des::e #b00000000000000000000000001000000) #b000000000000000000000000000000000000001000000000)
     (= (des::e #b00000000000000000000000000100000) #b000000000000000000000000000000000000000100000000)
     (= (des::e #b00000000000000000000000000010000) #b000000000000000000000000000000000000000010100000)
     (= (des::e #b00000000000000000000000000001000) #b000000000000000000000000000000000000000001010000)
     (= (des::e #b00000000000000000000000000000100) #b000000000000000000000000000000000000000000001000)
     (= (des::e #b00000000000000000000000000000010) #b000000000000000000000000000000000000000000000100)
     (= (des::e #b00000000000000000000000000000001) #b100000000000000000000000000000000000000000000010))
  t)

(sb-rt:deftest test-p-permutation
    (and
     (= (des::p #b10000000000000000000000000000000) #b00000000100000000000000000000000)
     (= (des::p #b01000000000000000000000000000000) #b00000000000000001000000000000000)
     (= (des::p #b00100000000000000000000000000000) #b00000000000000000000001000000000)
     (= (des::p #b00010000000000000000000000000000) #b00000000000000000000000000000010)

     (= (des::p #b00001000000000000000000000000000) #b00000000000010000000000000000000)
     (= (des::p #b00000100000000000000000000000000) #b00000000000000000000000000010000)
     (= (des::p #b00000010000000000000000000000000) #b01000000000000000000000000000000)
     (= (des::p #b00000001000000000000000000000000) #b00000000000000000100000000000000)

     (= (des::p #b00000000100000000000000000000000) #b00000000000000000000000100000000)
     (= (des::p #b00000000010000000000000000000000) #b00000000000000010000000000000000)
     (= (des::p #b00000000001000000000000000000000) #b00000000000000000000000000000100)
     (= (des::p #b00000000000100000000000000000000) #b00000100000000000000000000000000)

     (= (des::p #b00000000000010000000000000000000) #b00000000000000000000000001000000)
     (= (des::p #b00000000000001000000000000000000) #b00000000000000000001000000000000)
     (= (des::p #b00000000000000100000000000000000) #b00000000010000000000000000000000)
     (= (des::p #b00000000000000010000000000000000) #b10000000000000000000000000000000)

     (= (des::p #b00000000000000001000000000000000) #b00000001000000000000000000000000)
     (= (des::p #b00000000000000000100000000000000) #b00000000000001000000000000000000)
     (= (des::p #b00000000000000000010000000000000) #b00000000000000000000000010000000)
     (= (des::p #b00000000000000000001000000000000) #b00100000000000000000000000000000)

     (= (des::p #b00000000000000000000100000000000) #b00010000000000000000000000000000)
     (= (des::p #b00000000000000000000010000000000) #b00000000000000000000000000001000)
     (= (des::p #b00000000000000000000001000000000) #b00000000001000000000000000000000)
     (= (des::p #b00000000000000000000000100000000) #b00000000000000000010000000000000)

     (= (des::p #b00000000000000000000000010000000) #b00000000000000000000000000000001)
     (= (des::p #b00000000000000000000000001000000) #b00000000000100000000000000000000)
     (= (des::p #b00000000000000000000000000100000) #b00000000000000000000010000000000)
     (= (des::p #b00000000000000000000000000010000) #b00000010000000000000000000000000)

     (= (des::p #b00000000000000000000000000001000) #b00001000000000000000000000000000)
     (= (des::p #b00000000000000000000000000000100) #b00000000000000000000000000100000)
     (= (des::p #b00000000000000000000000000000010) #b00000000000000100000000000000000)
     (= (des::p #b00000000000000000000000000000001) #b00000000000000000000100000000000))
  t)