;;; NIST Special Publication 800-17
;;; Modes of Operation Validation System (MOVS): Requirements and Procedures

(in-package #:des-tests)

(defun encrypt-with-key (n key)
  (let ((des (make-instance 'des:des :cipher-key key)))
    (des:encrypt des n)))

(defun decrypt-with-key (n key)
  (let ((des (make-instance 'des:des :cipher-key key)))
    (des:decrypt des n)))

;;; Variable Plaintext Known Answer Test - ECB mode (Table 1)
(sb-rt:deftest test-des-5.1.1.1
    (let ((des (make-instance 'des:des :cipher-key #x0101010101010101)))
      (and
       (= (des:encrypt des #x8000000000000000) #x95F8A5E5DD31D900)
       (= (des:encrypt des #x4000000000000000) #xDD7F121CA5015619)
       (= (des:encrypt des #x2000000000000000) #x2E8653104F3834EA)
       (= (des:encrypt des #x1000000000000000) #x4BD388FF6CD81D4F)
       (= (des:encrypt des #x0800000000000000) #x20B9E767B2FB1456)
       (= (des:encrypt des #x0400000000000000) #x55579380D77138EF)
       (= (des:encrypt des #x0200000000000000) #x6CC5DEFAAF04512F)
       (= (des:encrypt des #x0100000000000000) #x0D9F279BA5D87260)
       (= (des:encrypt des #x0080000000000000) #xD9031B0271BD5A0A)
       (= (des:encrypt des #x0040000000000000) #x424250B37C3DD951)
       (= (des:encrypt des #x0020000000000000) #xB8061B7ECD9A21E5)
       (= (des:encrypt des #x0010000000000000) #xF15D0F286B65BD28)
       (= (des:encrypt des #x0008000000000000) #xADD0CC8D6E5DEBA1)
       (= (des:encrypt des #x0004000000000000) #xE6D5F82752AD63D1)

       (= (des:encrypt des #x0002000000000000) #xECBFE3BD3F591A5E)
       (= (des:encrypt des #x0001000000000000) #xF356834379D165CD)
       (= (des:encrypt des #x0000800000000000) #x2B9F982F20037FA9)
       (= (des:encrypt des #x0000400000000000) #x889DE068A16F0BE6)
       (= (des:encrypt des #x0000200000000000) #xE19E275D846A1298)
       (= (des:encrypt des #x0000100000000000) #x329A8ED523D71AEC)
       (= (des:encrypt des #x0000080000000000) #xE7FCE22557D23C97)
       (= (des:encrypt des #x0000040000000000) #x12A9F5817FF2D65D)
       (= (des:encrypt des #x0000020000000000) #xA484C3AD38DC9C19)
       (= (des:encrypt des #x0000010000000000) #xFBE00A8A1EF8AD72)
       (= (des:encrypt des #x0000008000000000) #x750D079407521363)
       (= (des:encrypt des #x0000004000000000) #x64FEED9C724C2FAF)
       (= (des:encrypt des #x0000002000000000) #xF02B263B328E2B60)
       (= (des:encrypt des #x0000001000000000) #x9D64555A9A10B852)
       (= (des:encrypt des #x0000000800000000) #xD106FF0BED5255D7)
       (= (des:encrypt des #x0000000400000000) #xE1652C6B138C64A5)
       (= (des:encrypt des #x0000000200000000) #xE428581186EC8F46)
       (= (des:encrypt des #x0000000100000000) #xAEB5F5EDE22D1A36)

       (= (des:encrypt des #x0000000080000000) #xE943D7568AEC0C5C)
       (= (des:encrypt des #x0000000040000000) #xDF98C8276F54B04B)
       (= (des:encrypt des #x0000000020000000) #xB160E4680F6C696F)
       (= (des:encrypt des #x0000000010000000) #xFA0752B07D9C4AB8)
       (= (des:encrypt des #x0000000008000000) #xCA3A2B036DBC8502)
       (= (des:encrypt des #x0000000004000000) #x5E0905517BB59BCF)
       (= (des:encrypt des #x0000000002000000) #x814EEB3B91D90726)
       (= (des:encrypt des #x0000000001000000) #x4D49DB1532919C9F)
       (= (des:encrypt des #x0000000000800000) #x25EB5FC3F8CF0621)
       (= (des:encrypt des #x0000000000400000) #xAB6A20C0620D1C6F)
       (= (des:encrypt des #x0000000000200000) #x79E90DBC98F92CCA)
       (= (des:encrypt des #x0000000000100000) #x866ECEDD8072BB0E)
       (= (des:encrypt des #x0000000000080000) #x8B54536F2F3E64A8)
       (= (des:encrypt des #x0000000000040000) #xEA51D3975595B86B)
       (= (des:encrypt des #x0000000000020000) #xCAFFC6AC4542DE31)
       (= (des:encrypt des #x0000000000010000) #x8DD45A2DDF90796C)
       (= (des:encrypt des #x0000000000008000) #x1029D55E880EC2D0)
       (= (des:encrypt des #x0000000000004000) #x5D86CB23639DBEA9)

       (= (des:encrypt des #x0000000000002000) #x1D1CA853AE7C0C5F)
       (= (des:encrypt des #x0000000000001000) #xCE332329248F3228)
       (= (des:encrypt des #x0000000000000800) #x8405D1ABE24FB942)
       (= (des:encrypt des #x0000000000000400) #xE643D78090CA4207)
       (= (des:encrypt des #x0000000000000200) #x48221B9937748A23)
       (= (des:encrypt des #x0000000000000100) #xDD7C0BBD61FAFD54)
       (= (des:encrypt des #x0000000000000080) #x2FBC291A570DB5C4)
       (= (des:encrypt des #x0000000000000040) #xE07C30D7E4E26E12)
       (= (des:encrypt des #x0000000000000020) #x0953E2258E8E90A1)
       (= (des:encrypt des #x0000000000000010) #x5B711BC4CEEBF2EE)
       (= (des:encrypt des #x0000000000000008) #xCC083F1E6D9E85F6)
       (= (des:encrypt des #x0000000000000004) #xD2FD8867D50D2DFE)
       (= (des:encrypt des #x0000000000000002) #x06E7EA22CE92708F)
       (= (des:encrypt des #x0000000000000001) #x166B40B44ABA4BD6)))
  t)

;;; Inverse Permutation Known Answer Test for the Encryption Process - ECB mode
(sb-rt:deftest test-des-5.1.1.2
    (let ((des (make-instance 'des:des :cipher-key #x0101010101010101)))
      (and
       (= (des:encrypt des #x95F8A5E5DD31D900) #x8000000000000000)
       (= (des:encrypt des #xDD7F121CA5015619) #x4000000000000000)
       (= (des:encrypt des #x2E8653104F3834EA) #x2000000000000000)
       (= (des:encrypt des #x4BD388FF6CD81D4F) #x1000000000000000)
       (= (des:encrypt des #x20B9E767B2FB1456) #x0800000000000000)
       (= (des:encrypt des #x55579380D77138EF) #x0400000000000000)
       (= (des:encrypt des #x6CC5DEFAAF04512F) #x0200000000000000)
       (= (des:encrypt des #x0D9F279BA5D87260) #x0100000000000000)
       (= (des:encrypt des #xD9031B0271BD5A0A) #x0080000000000000)
       (= (des:encrypt des #x424250B37C3DD951) #x0040000000000000)
       (= (des:encrypt des #xB8061B7ECD9A21E5) #x0020000000000000)
       (= (des:encrypt des #xF15D0F286B65BD28) #x0010000000000000)
       (= (des:encrypt des #xADD0CC8D6E5DEBA1) #x0008000000000000)
       (= (des:encrypt des #xE6D5F82752AD63D1) #x0004000000000000)

       (= (des:encrypt des #xECBFE3BD3F591A5E) #x0002000000000000)
       (= (des:encrypt des #xF356834379D165CD) #x0001000000000000)
       (= (des:encrypt des #x2B9F982F20037FA9) #x0000800000000000)
       (= (des:encrypt des #x889DE068A16F0BE6) #x0000400000000000)
       (= (des:encrypt des #xE19E275D846A1298) #x0000200000000000)
       (= (des:encrypt des #x329A8ED523D71AEC) #x0000100000000000)
       (= (des:encrypt des #xE7FCE22557D23C97) #x0000080000000000)
       (= (des:encrypt des #x12A9F5817FF2D65D) #x0000040000000000)
       (= (des:encrypt des #xA484C3AD38DC9C19) #x0000020000000000)
       (= (des:encrypt des #xFBE00A8A1EF8AD72) #x0000010000000000)
       (= (des:encrypt des #x750D079407521363) #x0000008000000000)
       (= (des:encrypt des #x64FEED9C724C2FAF) #x0000004000000000)
       (= (des:encrypt des #xF02B263B328E2B60) #x0000002000000000)
       (= (des:encrypt des #x9D64555A9A10B852) #x0000001000000000)
       (= (des:encrypt des #xD106FF0BED5255D7) #x0000000800000000)
       (= (des:encrypt des #xE1652C6B138C64A5) #x0000000400000000)
       (= (des:encrypt des #xE428581186EC8F46) #x0000000200000000)
       (= (des:encrypt des #xAEB5F5EDE22D1A36) #x0000000100000000)

       (= (des:encrypt des #xE943D7568AEC0C5C) #x0000000080000000)
       (= (des:encrypt des #xDF98C8276F54B04B) #x0000000040000000)
       (= (des:encrypt des #xB160E4680F6C696F) #x0000000020000000)
       (= (des:encrypt des #xFA0752B07D9C4AB8) #x0000000010000000)
       (= (des:encrypt des #xCA3A2B036DBC8502) #x0000000008000000)
       (= (des:encrypt des #x5E0905517BB59BCF) #x0000000004000000)
       (= (des:encrypt des #x814EEB3B91D90726) #x0000000002000000)
       (= (des:encrypt des #x4D49DB1532919C9F) #x0000000001000000)
       (= (des:encrypt des #x25EB5FC3F8CF0621) #x0000000000800000)
       (= (des:encrypt des #xAB6A20C0620D1C6F) #x0000000000400000)
       (= (des:encrypt des #x79E90DBC98F92CCA) #x0000000000200000)
       (= (des:encrypt des #x866ECEDD8072BB0E) #x0000000000100000)
       (= (des:encrypt des #x8B54536F2F3E64A8) #x0000000000080000)
       (= (des:encrypt des #xEA51D3975595B86B) #x0000000000040000)
       (= (des:encrypt des #xCAFFC6AC4542DE31) #x0000000000020000)
       (= (des:encrypt des #x8DD45A2DDF90796C) #x0000000000010000)
       (= (des:encrypt des #x1029D55E880EC2D0) #x0000000000008000)
       (= (des:encrypt des #x5D86CB23639DBEA9) #x0000000000004000)

       (= (des:encrypt des #x1D1CA853AE7C0C5F) #x0000000000002000)
       (= (des:encrypt des #xCE332329248F3228) #x0000000000001000)
       (= (des:encrypt des #x8405D1ABE24FB942) #x0000000000000800)
       (= (des:encrypt des #xE643D78090CA4207) #x0000000000000400)
       (= (des:encrypt des #x48221B9937748A23) #x0000000000000200)
       (= (des:encrypt des #xDD7C0BBD61FAFD54) #x0000000000000100)
       (= (des:encrypt des #x2FBC291A570DB5C4) #x0000000000000080)
       (= (des:encrypt des #xE07C30D7E4E26E12) #x0000000000000040)
       (= (des:encrypt des #x0953E2258E8E90A1) #x0000000000000020)
       (= (des:encrypt des #x5B711BC4CEEBF2EE) #x0000000000000010)
       (= (des:encrypt des #xCC083F1E6D9E85F6) #x0000000000000008)
       (= (des:encrypt des #xD2FD8867D50D2DFE) #x0000000000000004)
       (= (des:encrypt des #x06E7EA22CE92708F) #x0000000000000002)
       (= (des:encrypt des #x166B40B44ABA4BD6) #x0000000000000001)))
  t)

;;; Variable Key Known Answer Test for the Encryption Process - ECB mode (Table 2)
(sb-rt:deftest test-des-5.1.1.3
    (and
     (= (encrypt-with-key #x0000000000000000 #x8001010101010101) #x95A8D72813DAA94D)
     (= (encrypt-with-key #x0000000000000000 #x4001010101010101) #x0EEC1487DD8C26D5)
     (= (encrypt-with-key #x0000000000000000 #x2001010101010101) #x7AD16FFB79C45926)
     (= (encrypt-with-key #x0000000000000000 #x1001010101010101) #xD3746294CA6A6CF3)
     (= (encrypt-with-key #x0000000000000000 #x0801010101010101) #x809F5F873C1FD761)
     (= (encrypt-with-key #x0000000000000000 #x0401010101010101) #xC02FAFFEC989D1FC)
     (= (encrypt-with-key #x0000000000000000 #x0201010101010101) #x4615AA1D33E72F10)
     (= (encrypt-with-key #x0000000000000000 #x0180010101010101) #x2055123350C00858)
     (= (encrypt-with-key #x0000000000000000 #x0140010101010101) #xDF3B99D6577397C8)
     (= (encrypt-with-key #x0000000000000000 #x0120010101010101) #x31FE17369B5288C9)
     (= (encrypt-with-key #x0000000000000000 #x0110010101010101) #xDFDD3CC64DAE1642)
     (= (encrypt-with-key #x0000000000000000 #x0108010101010101) #x178C83CE2B399D94)
     (= (encrypt-with-key #x0000000000000000 #x0104010101010101) #x50F636324A9B7F80)
     (= (encrypt-with-key #x0000000000000000 #x0102010101010101) #xA8468EE3BC18F06D)
     (= (encrypt-with-key #x0000000000000000 #x0101800101010101) #xA2DC9E92FD3CDE92)

     (= (encrypt-with-key #x0000000000000000 #x0101400101010101) #xCAC09F797D031287)
     (= (encrypt-with-key #x0000000000000000 #x0101200101010101) #x90BA680B22AEB525)
     (= (encrypt-with-key #x0000000000000000 #x0101100101010101) #xCE7A24F350E280B6)
     (= (encrypt-with-key #x0000000000000000 #x0101080101010101) #x882BFF0AA01A0B87)
     (= (encrypt-with-key #x0000000000000000 #x0101040101010101) #x25610288924511C2)
     (= (encrypt-with-key #x0000000000000000 #x0101020101010101) #xC71516C29C75D170)
     (= (encrypt-with-key #x0000000000000000 #x0101018001010101) #x5199C29A52C9F059)
     (= (encrypt-with-key #x0000000000000000 #x0101014001010101) #xC22F0A294A71F29F)
     (= (encrypt-with-key #x0000000000000000 #x0101012001010101) #xEE371483714C02EA)
     (= (encrypt-with-key #x0000000000000000 #x0101011001010101) #xA81FBD448F9E522F)
     (= (encrypt-with-key #x0000000000000000 #x0101010801010101) #x4F644C92E192DFED)
     (= (encrypt-with-key #x0000000000000000 #x0101010401010101) #x1AFA9A66A6DF92AE)
     (= (encrypt-with-key #x0000000000000000 #x0101010201010101) #xB3C1CC715CB879D8)
     (= (encrypt-with-key #x0000000000000000 #x0101010180010101) #x19D032E64AB0BD8B)
     (= (encrypt-with-key #x0000000000000000 #x0101010140010101) #x3CFAA7A7DC8720DC)
     (= (encrypt-with-key #x0000000000000000 #x0101010120010101) #xB7265F7F447AC6F3)
     (= (encrypt-with-key #x0000000000000000 #x0101010110010101) #x9DB73B3C0D163F54)
     (= (encrypt-with-key #x0000000000000000 #x0101010108010101) #x8181B65BABF4A975)

     (= (encrypt-with-key #x0000000000000000 #x0101010104010101) #x93C9B64042EAA240)
     (= (encrypt-with-key #x0000000000000000 #x0101010102010101) #x5570530829705592)
     (= (encrypt-with-key #x0000000000000000 #x0101010101800101) #x8638809E878787A0)
     (= (encrypt-with-key #x0000000000000000 #x0101010101400101) #x41B9A79AF79AC208)
     (= (encrypt-with-key #x0000000000000000 #x0101010101200101) #x7A9BE42F2009A892)
     (= (encrypt-with-key #x0000000000000000 #x0101010101100101) #x29038D56BA6D2745)
     (= (encrypt-with-key #x0000000000000000 #x0101010101080101) #x5495C6ABF1E5DF51)
     (= (encrypt-with-key #x0000000000000000 #x0101010101040101) #xAE13DBD561488933)
     (= (encrypt-with-key #x0000000000000000 #x0101010101020101) #x024D1FFA8904E389)
     (= (encrypt-with-key #x0000000000000000 #x0101010101018001) #xD1399712F99BF02E)
     (= (encrypt-with-key #x0000000000000000 #x0101010101014001) #x14C1D7C1CFFEC79E)
     (= (encrypt-with-key #x0000000000000000 #x0101010101012001) #x1DE5279DAE3BED6F)
     (= (encrypt-with-key #x0000000000000000 #x0101010101011001) #xE941A33F85501303)
     (= (encrypt-with-key #x0000000000000000 #x0101010101010801) #xDA99DBBC9A03F379)
     (= (encrypt-with-key #x0000000000000000 #x0101010101010401) #xB7FC92F91D8E92E9)
     (= (encrypt-with-key #x0000000000000000 #x0101010101010201) #xAE8E5CAA3CA04E85)
     (= (encrypt-with-key #x0000000000000000 #x0101010101010180) #x9CC62DF43B6EED74)
     (= (encrypt-with-key #x0000000000000000 #x0101010101010140) #xD863DBB5C59A91A0)

     (= (encrypt-with-key #x0000000000000000 #x0101010101010120) #xA1AB2190545B91D7)
     (= (encrypt-with-key #x0000000000000000 #x0101010101010110) #x0875041E64C570F7)
     (= (encrypt-with-key #x0000000000000000 #x0101010101010108) #x5A594528BEBEF1CC)
     (= (encrypt-with-key #x0000000000000000 #x0101010101010104) #xFCDB3291DE21F0C0)
     (= (encrypt-with-key #x0000000000000000 #x0101010101010102) #x869EFD7F9F265A09))
  t)

;;; Permutation Operation Known Answer Test for the Encryption Process -- ECB mode (Table 3)
(sb-rt:deftest test-des-5.1.1.4
    (and
     (= (encrypt-with-key #x0000000000000000 #x1046913489980131) #x88D55E54F54C97B4)
     (= (encrypt-with-key #x0000000000000000 #x1007103489988020) #x0C0CC00C83EA48FD)
     (= (encrypt-with-key #x0000000000000000 #x10071034C8980120) #x83BC8EF3A6570183)
     (= (encrypt-with-key #x0000000000000000 #x1046103489988020) #xDF725DCAD94EA2E9)
     (= (encrypt-with-key #x0000000000000000 #x1086911519190101) #xE652B53B550BE8B0)
     (= (encrypt-with-key #x0000000000000000 #x1086911519580101) #xAF527120C485CBB0)
     (= (encrypt-with-key #x0000000000000000 #x5107B01519580101) #x0F04CE393DB926D5)
     (= (encrypt-with-key #x0000000000000000 #x1007B01519190101) #xC9F00FFC74079067)
     (= (encrypt-with-key #x0000000000000000 #x3107915498080101) #x7CFD82A593252B4E)
     (= (encrypt-with-key #x0000000000000000 #x3107919498080101) #xCB49A2F9E91363E3)
     (= (encrypt-with-key #x0000000000000000 #x10079115B9080140) #x00B588BE70D23F56)
     (= (encrypt-with-key #x0000000000000000 #x3107911598080140) #x406A9A6AB43399AE)
     (= (encrypt-with-key #x0000000000000000 #x1007D01589980101) #x6CB773611DCA9ADA)

     (= (encrypt-with-key #x0000000000000000 #x9107911589980101) #x67FD21C17DBB5D70)
     (= (encrypt-with-key #x0000000000000000 #x9107D01589190101) #x9592CB4110430787)
     (= (encrypt-with-key #x0000000000000000 #x1007D01598980120) #xA6B7FF68A318DDD3)
     (= (encrypt-with-key #x0000000000000000 #x1007940498190101) #x4D102196C914CA16)
     (= (encrypt-with-key #x0000000000000000 #x0107910491190401) #x2DFA9F4573594965)
     (= (encrypt-with-key #x0000000000000000 #x0107910491190101) #xB46604816C0E0774)
     (= (encrypt-with-key #x0000000000000000 #x0107940491190401) #x6E7E6221A4F34E87)
     (= (encrypt-with-key #x0000000000000000 #x19079210981A0101) #xAA85E74643233199)
     (= (encrypt-with-key #x0000000000000000 #x1007911998190801) #x2E5A19DB4D1962D6)
     (= (encrypt-with-key #x0000000000000000 #x10079119981A0801) #x23A866A809D30894)
     (= (encrypt-with-key #x0000000000000000 #x1007921098190101) #xD812D961F017D320)
     (= (encrypt-with-key #x0000000000000000 #x100791159819010B) #x055605816E58608F)
     (= (encrypt-with-key #x0000000000000000 #x1004801598190101) #xABD88E8B1B7716F1)
     (= (encrypt-with-key #x0000000000000000 #x1004801598190102) #x537AC95BE69DA1E1)
     (= (encrypt-with-key #x0000000000000000 #x1004801598190108) #xAED0F6AE3C25CDD8)
     (= (encrypt-with-key #x0000000000000000 #x1002911598100104) #xB3E35A5EE53E7B8D)
     (= (encrypt-with-key #x0000000000000000 #x1002911598190104) #x61C79C71921A2EF8)

     (= (encrypt-with-key #x0000000000000000 #x1002911598100201) #xE2F5728F0995013C)
     (= (encrypt-with-key #x0000000000000000 #x1002911698100101) #x1AEAC39A61F0A464)
     )
  t)

;;; Substitution Table Known Answer Test for the Encryption Process - ECB mode (Table 4)
(sb-rt:deftest test-des-5.1.1.5
    (and
     (= (encrypt-with-key #x01A1D6D039776742 #x7CA110454A1A6E57) #x690F5B0D9A26939B)
     (= (encrypt-with-key #x5CD54CA83DEF57DA #x0131D9619DC1376E) #x7A389D10354BD271)
     (= (encrypt-with-key #x0248D43806F67172 #x07A1133E4A0B2686) #x868EBB51CAB4599A)
     (= (encrypt-with-key #x51454B582DDF440A #x3849674C2602319E) #x7178876E01F19B2A)
     (= (encrypt-with-key #x42FD443059577FA2 #x04B915BA43FEB5B6) #xAF37FB421F8C4095)
     (= (encrypt-with-key #x059B5E0851CF143A #x0113B970FD34F2CE) #x86A560F10EC6D85B)
     (= (encrypt-with-key #x0756D8E0774761D2 #x0170F175468FB5E6) #x0CD3DA020021DC09)
     (= (encrypt-with-key #x762514B829BF486A #x43297FAD38E373FE) #xEA676B2CB7DB2B7A)
     (= (encrypt-with-key #x3BDD119049372802 #x07A7137045DA2A16) #xDFD64A815CAF1A0F)
     (= (encrypt-with-key #x26955F6835AF609A #x04689104C2FD3B2F) #x5C513C9C4886C088)
     (= (encrypt-with-key #x164D5E404F275232 #x37D06BB516CB7546) #x0A2AEEAE3FF4AB77)
     (= (encrypt-with-key #x6B056E18759F5CCA #x1F08260D1AC2465E) #xEF1BF03E5DFA575A)
     (= (encrypt-with-key #x004BD6EF09176062 #x584023641ABA6176) #x88BF0DB6D70DEE56)
     (= (encrypt-with-key #x480D39006EE762F2 #x025816164629B007) #xA1F9915541020B56)
     (= (encrypt-with-key #x437540C8698F3CFA #x49793EBC79B3258F) #x6FBF1CAFCFFD0556)
     (= (encrypt-with-key #x072D43A077075292 #x4FB05E1515AB73A7) #x2F22E49BAB7CA1AC)
     (= (encrypt-with-key #x02FE55778117F12A #x49E95D6D4CA229BF) #x5A6B612CC26CCE4A)
     (= (encrypt-with-key #x1D9D5C5018F728C2 #x018310DC409B26D6) #x5F4C038ED12B2E41)
     (= (encrypt-with-key #x305532286D6F295A #x1C587F1C13924FEF) #x63FAC0D034D9F793))
  t)

;;; Variable Ciphertext Known Answer Test - ECB Mode (Table 1)
(sb-rt:deftest test-des-5.1.2.1
    (let ((des (make-instance 'des:des :cipher-key #x0101010101010101)))
      (and
       (= (des:decrypt des #x95F8A5E5DD31D900) #x8000000000000000)
       (= (des:decrypt des #xDD7F121CA5015619) #x4000000000000000)
       (= (des:decrypt des #x2E8653104F3834EA) #x2000000000000000)
       (= (des:decrypt des #x4BD388FF6CD81D4F) #x1000000000000000)
       (= (des:decrypt des #x20B9E767B2FB1456) #x0800000000000000)
       (= (des:decrypt des #x55579380D77138EF) #x0400000000000000)
       (= (des:decrypt des #x6CC5DEFAAF04512F) #x0200000000000000)
       (= (des:decrypt des #x0D9F279BA5D87260) #x0100000000000000)
       (= (des:decrypt des #xD9031B0271BD5A0A) #x0080000000000000)
       (= (des:decrypt des #x424250B37C3DD951) #x0040000000000000)
       (= (des:decrypt des #xB8061B7ECD9A21E5) #x0020000000000000)
       (= (des:decrypt des #xF15D0F286B65BD28) #x0010000000000000)
       (= (des:decrypt des #xADD0CC8D6E5DEBA1) #x0008000000000000)
       (= (des:decrypt des #xE6D5F82752AD63D1) #x0004000000000000)

       (= (des:decrypt des #xECBFE3BD3F591A5E) #x0002000000000000)
       (= (des:decrypt des #xF356834379D165CD) #x0001000000000000)
       (= (des:decrypt des #x2B9F982F20037FA9) #x0000800000000000)
       (= (des:decrypt des #x889DE068A16F0BE6) #x0000400000000000)
       (= (des:decrypt des #xE19E275D846A1298) #x0000200000000000)
       (= (des:decrypt des #x329A8ED523D71AEC) #x0000100000000000)
       (= (des:decrypt des #xE7FCE22557D23C97) #x0000080000000000)
       (= (des:decrypt des #x12A9F5817FF2D65D) #x0000040000000000)
       (= (des:decrypt des #xA484C3AD38DC9C19) #x0000020000000000)
       (= (des:decrypt des #xFBE00A8A1EF8AD72) #x0000010000000000)
       (= (des:decrypt des #x750D079407521363) #x0000008000000000)
       (= (des:decrypt des #x64FEED9C724C2FAF) #x0000004000000000)
       (= (des:decrypt des #xF02B263B328E2B60) #x0000002000000000)
       (= (des:decrypt des #x9D64555A9A10B852) #x0000001000000000)
       (= (des:decrypt des #xD106FF0BED5255D7) #x0000000800000000)
       (= (des:decrypt des #xE1652C6B138C64A5) #x0000000400000000)
       (= (des:decrypt des #xE428581186EC8F46) #x0000000200000000)
       (= (des:decrypt des #xAEB5F5EDE22D1A36) #x0000000100000000)

       (= (des:decrypt des #xE943D7568AEC0C5C) #x0000000080000000)
       (= (des:decrypt des #xDF98C8276F54B04B) #x0000000040000000)
       (= (des:decrypt des #xB160E4680F6C696F) #x0000000020000000)
       (= (des:decrypt des #xFA0752B07D9C4AB8) #x0000000010000000)
       (= (des:decrypt des #xCA3A2B036DBC8502) #x0000000008000000)
       (= (des:decrypt des #x5E0905517BB59BCF) #x0000000004000000)
       (= (des:decrypt des #x814EEB3B91D90726) #x0000000002000000)
       (= (des:decrypt des #x4D49DB1532919C9F) #x0000000001000000)
       (= (des:decrypt des #x25EB5FC3F8CF0621) #x0000000000800000)
       (= (des:decrypt des #xAB6A20C0620D1C6F) #x0000000000400000)
       (= (des:decrypt des #x79E90DBC98F92CCA) #x0000000000200000)
       (= (des:decrypt des #x866ECEDD8072BB0E) #x0000000000100000)
       (= (des:decrypt des #x8B54536F2F3E64A8) #x0000000000080000)
       (= (des:decrypt des #xEA51D3975595B86B) #x0000000000040000)
       (= (des:decrypt des #xCAFFC6AC4542DE31) #x0000000000020000)
       (= (des:decrypt des #x8DD45A2DDF90796C) #x0000000000010000)
       (= (des:decrypt des #x1029D55E880EC2D0) #x0000000000008000)
       (= (des:decrypt des #x5D86CB23639DBEA9) #x0000000000004000)

       (= (des:decrypt des #x1D1CA853AE7C0C5F) #x0000000000002000)
       (= (des:decrypt des #xCE332329248F3228) #x0000000000001000)
       (= (des:decrypt des #x8405D1ABE24FB942) #x0000000000000800)
       (= (des:decrypt des #xE643D78090CA4207) #x0000000000000400)
       (= (des:decrypt des #x48221B9937748A23) #x0000000000000200)
       (= (des:decrypt des #xDD7C0BBD61FAFD54) #x0000000000000100)
       (= (des:decrypt des #x2FBC291A570DB5C4) #x0000000000000080)
       (= (des:decrypt des #xE07C30D7E4E26E12) #x0000000000000040)
       (= (des:decrypt des #x0953E2258E8E90A1) #x0000000000000020)
       (= (des:decrypt des #x5B711BC4CEEBF2EE) #x0000000000000010)
       (= (des:decrypt des #xCC083F1E6D9E85F6) #x0000000000000008)
       (= (des:decrypt des #xD2FD8867D50D2DFE) #x0000000000000004)
       (= (des:decrypt des #x06E7EA22CE92708F) #x0000000000000002)
       (= (des:decrypt des #x166B40B44ABA4BD6) #x0000000000000001)))
  t)

;;; Initial Permutation Known Answer Test for the Decryption Process - ECB Mode (Table 1)
(sb-rt:deftest test-des-5.1.2.2
    (let ((des (make-instance 'des:des :cipher-key #x0101010101010101)))
      (and
       (= (des:decrypt des #x8000000000000000) #x95F8A5E5DD31D900)
       (= (des:decrypt des #x4000000000000000) #xDD7F121CA5015619)
       (= (des:decrypt des #x2000000000000000) #x2E8653104F3834EA)
       (= (des:decrypt des #x1000000000000000) #x4BD388FF6CD81D4F)
       (= (des:decrypt des #x0800000000000000) #x20B9E767B2FB1456)
       (= (des:decrypt des #x0400000000000000) #x55579380D77138EF)
       (= (des:decrypt des #x0200000000000000) #x6CC5DEFAAF04512F)
       (= (des:decrypt des #x0100000000000000) #x0D9F279BA5D87260)
       (= (des:decrypt des #x0080000000000000) #xD9031B0271BD5A0A)
       (= (des:decrypt des #x0040000000000000) #x424250B37C3DD951)
       (= (des:decrypt des #x0020000000000000) #xB8061B7ECD9A21E5)
       (= (des:decrypt des #x0010000000000000) #xF15D0F286B65BD28)
       (= (des:decrypt des #x0008000000000000) #xADD0CC8D6E5DEBA1)
       (= (des:decrypt des #x0004000000000000) #xE6D5F82752AD63D1)

       (= (des:decrypt des #x0002000000000000) #xECBFE3BD3F591A5E)
       (= (des:decrypt des #x0001000000000000) #xF356834379D165CD)
       (= (des:decrypt des #x0000800000000000) #x2B9F982F20037FA9)
       (= (des:decrypt des #x0000400000000000) #x889DE068A16F0BE6)
       (= (des:decrypt des #x0000200000000000) #xE19E275D846A1298)
       (= (des:decrypt des #x0000100000000000) #x329A8ED523D71AEC)
       (= (des:decrypt des #x0000080000000000) #xE7FCE22557D23C97)
       (= (des:decrypt des #x0000040000000000) #x12A9F5817FF2D65D)
       (= (des:decrypt des #x0000020000000000) #xA484C3AD38DC9C19)
       (= (des:decrypt des #x0000010000000000) #xFBE00A8A1EF8AD72)
       (= (des:decrypt des #x0000008000000000) #x750D079407521363)
       (= (des:decrypt des #x0000004000000000) #x64FEED9C724C2FAF)
       (= (des:decrypt des #x0000002000000000) #xF02B263B328E2B60)
       (= (des:decrypt des #x0000001000000000) #x9D64555A9A10B852)
       (= (des:decrypt des #x0000000800000000) #xD106FF0BED5255D7)
       (= (des:decrypt des #x0000000400000000) #xE1652C6B138C64A5)
       (= (des:decrypt des #x0000000200000000) #xE428581186EC8F46)
       (= (des:decrypt des #x0000000100000000) #xAEB5F5EDE22D1A36)

       (= (des:decrypt des #x0000000080000000) #xE943D7568AEC0C5C)
       (= (des:decrypt des #x0000000040000000) #xDF98C8276F54B04B)
       (= (des:decrypt des #x0000000020000000) #xB160E4680F6C696F)
       (= (des:decrypt des #x0000000010000000) #xFA0752B07D9C4AB8)
       (= (des:decrypt des #x0000000008000000) #xCA3A2B036DBC8502)
       (= (des:decrypt des #x0000000004000000) #x5E0905517BB59BCF)
       (= (des:decrypt des #x0000000002000000) #x814EEB3B91D90726)
       (= (des:decrypt des #x0000000001000000) #x4D49DB1532919C9F)
       (= (des:decrypt des #x0000000000800000) #x25EB5FC3F8CF0621)
       (= (des:decrypt des #x0000000000400000) #xAB6A20C0620D1C6F)
       (= (des:decrypt des #x0000000000200000) #x79E90DBC98F92CCA)
       (= (des:decrypt des #x0000000000100000) #x866ECEDD8072BB0E)
       (= (des:decrypt des #x0000000000080000) #x8B54536F2F3E64A8)
       (= (des:decrypt des #x0000000000040000) #xEA51D3975595B86B)
       (= (des:decrypt des #x0000000000020000) #xCAFFC6AC4542DE31)
       (= (des:decrypt des #x0000000000010000) #x8DD45A2DDF90796C)
       (= (des:decrypt des #x0000000000008000) #x1029D55E880EC2D0)
       (= (des:decrypt des #x0000000000004000) #x5D86CB23639DBEA9)

       (= (des:decrypt des #x0000000000002000) #x1D1CA853AE7C0C5F)
       (= (des:decrypt des #x0000000000001000) #xCE332329248F3228)
       (= (des:decrypt des #x0000000000000800) #x8405D1ABE24FB942)
       (= (des:decrypt des #x0000000000000400) #xE643D78090CA4207)
       (= (des:decrypt des #x0000000000000200) #x48221B9937748A23)
       (= (des:decrypt des #x0000000000000100) #xDD7C0BBD61FAFD54)
       (= (des:decrypt des #x0000000000000080) #x2FBC291A570DB5C4)
       (= (des:decrypt des #x0000000000000040) #xE07C30D7E4E26E12)
       (= (des:decrypt des #x0000000000000020) #x0953E2258E8E90A1)
       (= (des:decrypt des #x0000000000000010) #x5B711BC4CEEBF2EE)
       (= (des:decrypt des #x0000000000000008) #xCC083F1E6D9E85F6)
       (= (des:decrypt des #x0000000000000004) #xD2FD8867D50D2DFE)
       (= (des:decrypt des #x0000000000000002) #x06E7EA22CE92708F)
       (= (des:decrypt des #x0000000000000001) #x166B40B44ABA4BD6)))
  t)

;;; Variable Key Known Answer Test for the Decryption Process - ECB Mode (Table 2)
(sb-rt:deftest test-des-5.1.2.3
    (and
     (= (decrypt-with-key #x95A8D72813DAA94D #x8001010101010101) #x0000000000000000)
     (= (decrypt-with-key #x0EEC1487DD8C26D5 #x4001010101010101) #x0000000000000000)
     (= (decrypt-with-key #x7AD16FFB79C45926 #x2001010101010101) #x0000000000000000)
     (= (decrypt-with-key #xD3746294CA6A6CF3 #x1001010101010101) #x0000000000000000)
     (= (decrypt-with-key #x809F5F873C1FD761 #x0801010101010101) #x0000000000000000)
     (= (decrypt-with-key #xC02FAFFEC989D1FC #x0401010101010101) #x0000000000000000)
     (= (decrypt-with-key #x4615AA1D33E72F10 #x0201010101010101) #x0000000000000000)
     (= (decrypt-with-key #x2055123350C00858 #x0180010101010101) #x0000000000000000)
     (= (decrypt-with-key #xDF3B99D6577397C8 #x0140010101010101) #x0000000000000000)
     (= (decrypt-with-key #x31FE17369B5288C9 #x0120010101010101) #x0000000000000000)
     (= (decrypt-with-key #xDFDD3CC64DAE1642 #x0110010101010101) #x0000000000000000)
     (= (decrypt-with-key #x178C83CE2B399D94 #x0108010101010101) #x0000000000000000)
     (= (decrypt-with-key #x50F636324A9B7F80 #x0104010101010101) #x0000000000000000)
     (= (decrypt-with-key #xA8468EE3BC18F06D #x0102010101010101) #x0000000000000000)
     (= (decrypt-with-key #xA2DC9E92FD3CDE92 #x0101800101010101) #x0000000000000000)

     (= (decrypt-with-key #xCAC09F797D031287 #x0101400101010101) #x0000000000000000)
     (= (decrypt-with-key #x90BA680B22AEB525 #x0101200101010101) #x0000000000000000)
     (= (decrypt-with-key #xCE7A24F350E280B6 #x0101100101010101) #x0000000000000000)
     (= (decrypt-with-key #x882BFF0AA01A0B87 #x0101080101010101) #x0000000000000000)
     (= (decrypt-with-key #x25610288924511C2 #x0101040101010101) #x0000000000000000)
     (= (decrypt-with-key #xC71516C29C75D170 #x0101020101010101) #x0000000000000000)
     (= (decrypt-with-key #x5199C29A52C9F059 #x0101018001010101) #x0000000000000000)
     (= (decrypt-with-key #xC22F0A294A71F29F #x0101014001010101) #x0000000000000000)
     (= (decrypt-with-key #xEE371483714C02EA #x0101012001010101) #x0000000000000000)
     (= (decrypt-with-key #xA81FBD448F9E522F #x0101011001010101) #x0000000000000000)
     (= (decrypt-with-key #x4F644C92E192DFED #x0101010801010101) #x0000000000000000)
     (= (decrypt-with-key #x1AFA9A66A6DF92AE #x0101010401010101) #x0000000000000000)
     (= (decrypt-with-key #xB3C1CC715CB879D8 #x0101010201010101) #x0000000000000000)
     (= (decrypt-with-key #x19D032E64AB0BD8B #x0101010180010101) #x0000000000000000)
     (= (decrypt-with-key #x3CFAA7A7DC8720DC #x0101010140010101) #x0000000000000000)
     (= (decrypt-with-key #xB7265F7F447AC6F3 #x0101010120010101) #x0000000000000000)
     (= (decrypt-with-key #x9DB73B3C0D163F54 #x0101010110010101) #x0000000000000000)
     (= (decrypt-with-key #x8181B65BABF4A975 #x0101010108010101) #x0000000000000000)

     (= (decrypt-with-key #x93C9B64042EAA240 #x0101010104010101) #x0000000000000000)
     (= (decrypt-with-key #x5570530829705592 #x0101010102010101) #x0000000000000000)
     (= (decrypt-with-key #x8638809E878787A0 #x0101010101800101) #x0000000000000000)
     (= (decrypt-with-key #x41B9A79AF79AC208 #x0101010101400101) #x0000000000000000)
     (= (decrypt-with-key #x7A9BE42F2009A892 #x0101010101200101) #x0000000000000000)
     (= (decrypt-with-key #x29038D56BA6D2745 #x0101010101100101) #x0000000000000000)
     (= (decrypt-with-key #x5495C6ABF1E5DF51 #x0101010101080101) #x0000000000000000)
     (= (decrypt-with-key #xAE13DBD561488933 #x0101010101040101) #x0000000000000000)
     (= (decrypt-with-key #x024D1FFA8904E389 #x0101010101020101) #x0000000000000000)
     (= (decrypt-with-key #xD1399712F99BF02E #x0101010101018001) #x0000000000000000)
     (= (decrypt-with-key #x14C1D7C1CFFEC79E #x0101010101014001) #x0000000000000000)
     (= (decrypt-with-key #x1DE5279DAE3BED6F #x0101010101012001) #x0000000000000000)
     (= (decrypt-with-key #xE941A33F85501303 #x0101010101011001) #x0000000000000000)
     (= (decrypt-with-key #xDA99DBBC9A03F379 #x0101010101010801) #x0000000000000000)
     (= (decrypt-with-key #xB7FC92F91D8E92E9 #x0101010101010401) #x0000000000000000)
     (= (decrypt-with-key #xAE8E5CAA3CA04E85 #x0101010101010201) #x0000000000000000)
     (= (decrypt-with-key #x9CC62DF43B6EED74 #x0101010101010180) #x0000000000000000)
     (= (decrypt-with-key #xD863DBB5C59A91A0 #x0101010101010140) #x0000000000000000)

     (= (decrypt-with-key #xA1AB2190545B91D7 #x0101010101010120) #x0000000000000000)
     (= (decrypt-with-key #x0875041E64C570F7 #x0101010101010110) #x0000000000000000)
     (= (decrypt-with-key #x5A594528BEBEF1CC #x0101010101010108) #x0000000000000000)
     (= (decrypt-with-key #xFCDB3291DE21F0C0 #x0101010101010104) #x0000000000000000)
     (= (decrypt-with-key #x869EFD7F9F265A09 #x0101010101010102) #x0000000000000000))
  t)

;;; Permutation Operation Known Answer Test for the Decryption Process - ECB Mode (Table 3)
(sb-rt:deftest test-des-5.1.2.4
    (and
     (= (decrypt-with-key #x88D55E54F54C97B4 #x1046913489980131) #x0000000000000000)
     (= (decrypt-with-key #x0C0CC00C83EA48FD #x1007103489988020) #x0000000000000000)
     (= (decrypt-with-key #x83BC8EF3A6570183 #x10071034C8980120) #x0000000000000000)
     (= (decrypt-with-key #xDF725DCAD94EA2E9 #x1046103489988020) #x0000000000000000)
     (= (decrypt-with-key #xE652B53B550BE8B0 #x1086911519190101) #x0000000000000000)
     (= (decrypt-with-key #xAF527120C485CBB0 #x1086911519580101) #x0000000000000000)
     (= (decrypt-with-key #x0F04CE393DB926D5 #x5107B01519580101) #x0000000000000000)
     (= (decrypt-with-key #xC9F00FFC74079067 #x1007B01519190101) #x0000000000000000)
     (= (decrypt-with-key #x7CFD82A593252B4E #x3107915498080101) #x0000000000000000)
     (= (decrypt-with-key #xCB49A2F9E91363E3 #x3107919498080101) #x0000000000000000)
     (= (decrypt-with-key #x00B588BE70D23F56 #x10079115B9080140) #x0000000000000000)
     (= (decrypt-with-key #x406A9A6AB43399AE #x3107911598080140) #x0000000000000000)
     (= (decrypt-with-key #x6CB773611DCA9ADA #x1007D01589980101) #x0000000000000000)

     (= (decrypt-with-key #x67FD21C17DBB5D70 #x9107911589980101) #x0000000000000000)
     (= (decrypt-with-key #x9592CB4110430787 #x9107D01589190101) #x0000000000000000)
     (= (decrypt-with-key #xA6B7FF68A318DDD3 #x1007D01598980120) #x0000000000000000)
     (= (decrypt-with-key #x4D102196C914CA16 #x1007940498190101) #x0000000000000000)
     (= (decrypt-with-key #x2DFA9F4573594965 #x0107910491190401) #x0000000000000000)
     (= (decrypt-with-key #xB46604816C0E0774 #x0107910491190101) #x0000000000000000)
     (= (decrypt-with-key #x6E7E6221A4F34E87 #x0107940491190401) #x0000000000000000)
     (= (decrypt-with-key #xAA85E74643233199 #x19079210981A0101) #x0000000000000000)
     (= (decrypt-with-key #x2E5A19DB4D1962D6 #x1007911998190801) #x0000000000000000)
     (= (decrypt-with-key #x23A866A809D30894 #x10079119981A0801) #x0000000000000000)
     (= (decrypt-with-key #xD812D961F017D320 #x1007921098190101) #x0000000000000000)
     (= (decrypt-with-key #x055605816E58608F #x100791159819010B) #x0000000000000000)
     (= (decrypt-with-key #xABD88E8B1B7716F1 #x1004801598190101) #x0000000000000000)
     (= (decrypt-with-key #x537AC95BE69DA1E1 #x1004801598190102) #x0000000000000000)
     (= (decrypt-with-key #xAED0F6AE3C25CDD8 #x1004801598190108) #x0000000000000000)
     (= (decrypt-with-key #xB3E35A5EE53E7B8D #x1002911598100104) #x0000000000000000)
     (= (decrypt-with-key #x61C79C71921A2EF8 #x1002911598190104) #x0000000000000000)

     (= (decrypt-with-key #xE2F5728F0995013C #x1002911598100201) #x0000000000000000)
     (= (decrypt-with-key #x1AEAC39A61F0A464 #x1002911698100101) #x0000000000000000)
     )
  t)

;;; Substitution Table Known Answer Test for the Decryption Process - ECB Mode (Table 4)
(sb-rt:deftest test-des-5.1.2.5
    (and
     (= (decrypt-with-key #x690F5B0D9A26939B #x7CA110454A1A6E57) #x01A1D6D039776742)
     (= (decrypt-with-key #x7A389D10354BD271 #x0131D9619DC1376E) #x5CD54CA83DEF57DA)
     (= (decrypt-with-key #x868EBB51CAB4599A #x07A1133E4A0B2686) #x0248D43806F67172)
     (= (decrypt-with-key #x7178876E01F19B2A #x3849674C2602319E) #x51454B582DDF440A)
     (= (decrypt-with-key #xAF37FB421F8C4095 #x04B915BA43FEB5B6) #x42FD443059577FA2)
     (= (decrypt-with-key #x86A560F10EC6D85B #x0113B970FD34F2CE) #x059B5E0851CF143A)
     (= (decrypt-with-key #x0CD3DA020021DC09 #x0170F175468FB5E6) #x0756D8E0774761D2)
     (= (decrypt-with-key #xEA676B2CB7DB2B7A #x43297FAD38E373FE) #x762514B829BF486A)
     (= (decrypt-with-key #xDFD64A815CAF1A0F #x07A7137045DA2A16) #x3BDD119049372802)
     (= (decrypt-with-key #x5C513C9C4886C088 #x04689104C2FD3B2F) #x26955F6835AF609A)
     (= (decrypt-with-key #x0A2AEEAE3FF4AB77 #x37D06BB516CB7546) #x164D5E404F275232)
     (= (decrypt-with-key #xEF1BF03E5DFA575A #x1F08260D1AC2465E) #x6B056E18759F5CCA)
     (= (decrypt-with-key #x88BF0DB6D70DEE56 #x584023641ABA6176) #x004BD6EF09176062)
     (= (decrypt-with-key #xA1F9915541020B56 #x025816164629B007) #x480D39006EE762F2)
     (= (decrypt-with-key #x6FBF1CAFCFFD0556 #x49793EBC79B3258F) #x437540C8698F3CFA)
     (= (decrypt-with-key #x2F22E49BAB7CA1AC #x4FB05E1515AB73A7) #x072D43A077075292)
     (= (decrypt-with-key #x5A6B612CC26CCE4A #x49E95D6D4CA229BF) #x02FE55778117F12A)
     (= (decrypt-with-key #x5F4C038ED12B2E41 #x018310DC409B26D6) #x1D9D5C5018F728C2)
     (= (decrypt-with-key #x63FAC0D034D9F793 #x1C587F1C13924FEF) #x305532286D6F295A))
  t)
